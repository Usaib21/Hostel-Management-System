{% extends 'base.html' %}
{% load static %}

{% comment %} <!doctype html>
<html lang="en"> {% endcomment %}
  {% block content %}
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link href="{% static 'menu/style.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.18.0/font/bootstrap-icons.css" rel="stylesheet">

    <script>
      // Function to show the profile card
      function showProfileCard() {
        document.getElementById('profileCard').style.display = 'block';
      }

      // Function to hide the profile card
      function hideProfileCard() {
        document.getElementById('profileCard').style.display = 'none';
      }
    </script>

  </head>
  <body>
    {% include 'messages.html' %} 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <!-- navbar start -->
    {% comment %} <nav class="navbar navbar-expand-lg bg-body-tertiary"> {% endcomment %}
      <nav class="navbar navbar-expand-lg navbar-dark navbar-dark-bg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">HOSTEL MANAGEMENT SYSTEM</a>
            <button id="notification-button" class="icon-button" type="button">
                <i class="bi bi-bell-fill"></i>
                <span class="badge">{{ unseen_count }}</span>
            </button>
    
            <!-- Add Admin dropdown as a button -->
            <li class="nav-item dropdown"  style="list-style-type: none; margin-left: 52%;">
              <div class="btn-group">
                  <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      Admin
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                      <li><a class="dropdown-item" style="font-weight: bold;" href="{% url 'admin:login' %}">Admin Login</a></li>
                      <li><a class="dropdown-item" style="font-weight: bold;" href="{% url 'take_attendance' %}">Take Attendance</a></li>
                  </ul>
              </div>
          </li>
          
    
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="btn btn-primary" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample">
                            <span class="navbar-toggler-icon"></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
     <!-- navbar end -->
    <!-- off canvas start -->
    
    
    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel"style="font-weight: bold;">Hostel Management</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'home' %}">
              <i class="bi bi-house-fill"></i> Home
            </a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="{% url 'hostel_details' %}">
              <i class="bi bi-ticket-detailed-fill"></i> Hostel Details
            </a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="{% url 'hostel_allotment_registration' %}">
              <i class="bi bi-bookmark-dash-fill"></i></i> Hostel Registration
            </a>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="paymentsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-credit-card-fill"></i> Payments
            </a>
            <ul class="dropdown-menu" aria-labelledby="paymentsDropdown">
              <li><a class="dropdown-item" href="{% url 'hostel_payments' %}"><i class="bi bi-caret-right-fill"></i> Hostel</a></li>
              <li><a class="dropdown-item" href="{% url 'mess_payments' %}"><i class="bi bi-caret-right-fill"></i> Mess</a></li>
            </ul>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="{% url 'view_attendance' %}">
              <i class="bi bi-eye-fill"></i> Attendance
            </a>
          </li>
          
          <li class "nav-item">
            <a class="nav-link" href="{% url 'menu_page' %}">
              <i class="bi bi-menu-app-fill"></i> Menu
            </a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="{% url 'feedback_complaint' %}">
              <i class="bi bi-stars"></i> Feedback & Complaints
            </a>
          </li>
          
      
          <!-- Add more nav items as needed -->
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item" style="position: absolute; bottom: 10px; left: 10px;"> <!-- Adjust the position as needed -->
                <a id="userProfileLink" class="nav-link user-profile-link" href="#" onclick="showProfileCard()">
                    <i class="bi bi-person-fill user-profile-icon" style="font-size: 36px;"></i>
                    <span style="font-size: 24px;">Profile</span>
                </a>
            </li>
        </ul>
      </ul>
      </div>
    </div>
    {% comment %} <div class="card-body">
      <h5 class="card-title">Special title treatment</h5>
      <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
      {% comment %} <a href="#" class="btn btn-primary">Go somewhere</a>
    </div> {% endcomment %}

    <div class="container-fluid" my-4 px-0 style="margin-top: 2px; height: 20px; margin-left: 1px; margin-right: 1px; padding-left: 1px; padding-right: 1px;">
  <div id="carouselExampleCaptions" class="carousel slide">
    <div class="carousel-indicators">
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
    </div>
    <div class="carousel-inner"  style="height: 400px;">
      <div class="carousel-item active">
        <img src="/static/images/R3.jpg" class="d-block w-100" alt="...">
        <div class="carousel-caption d-none d-md-block">
          <h5><strong>Hostel Room</strong></h5>
          <p style="color: #0cb300;">
            <strong>They are the ones on whom you trust more than a brother, but less than a friend. They are your roommates.</strong>
          </p>
        </div>
      </div>
      <div class="carousel-item">
        {% comment %} <img src="https://source.unsplash.com/random/1600x400?sig=3" /> {% endcomment %}
        <img src="/static/images/img5.jpg" class="d-block w-100" alt="...">
        <div class="carousel-caption d-none d-md-block">
          <h5><strong>Hostel</strong></h5>
          <p style="color: #ff4d00">
            <strong>Those who have never experienced hostel life ever, I feel sorry for them.</strong>
          </p>
          <p>Hostel life is all about the journey, not the destination.</p>
        </div>
      </div>
      <div class="carousel-item">
        <img src="/static/images/pexelsh.jpg" class="d-block w-100" alt="...">
        {% comment %} <img src="https://source.unsplash.com/dogs/1600x400?sig=2" /> {% endcomment %}
        <div class="carousel-caption d-none d-md-block">
          <h5>Third slide label</h5>
          <p>Hostel life is all about the journey, not the destination.</p>
        </div>
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>    
</div>
    <!-- off canvas end -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <!-- script for messaging -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>



  <!-- ... Your existing HTML code ... -->
  {% comment %} <div class="container-fluid my-4 px-0" style="margin-top: 2px;">
    <iframe src="https://iust.ac.in/notice-archives.aspx" width="100%" height="600px" frameborder="0"></iframe>
  </div> {% endcomment %}

  <div class="container" style="margin-top: 400px; margin-bottom: 20px;">
  
    <div class="conatainer my-4">
    <div class="row mb-2">
      <div class="col-md-6">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            <strong class="d-inline-block mb-2 text-primary">Islamic University of Science and Technology</strong>
            <h3 class="mb-0">IUST Official</h3>
            <div class="mb-1 text-muted">Dec 11 , 2023</div>
            <p class="card-text mb-auto">The Islamic University of Science and Technology (IUST), Awantipora, J&K has been established through an Act No. XVIII of 2005 dated: 7th November 2005 passed by J&K State Legislature and notified by the State Government.</p>
            <a href="https://www.iust.ac.in/#!" class="stretched-link" target="blank">Continue reading</a>
          </div>
          <div class="col-auto d-none d-lg-block">
            <img class="bd-placeholder-img" width="200" height="250" src="/static/images/iust.jpg" alt="js_pic">  
            </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            <strong class="d-inline-block mb-2 text-success">Weather</strong>
            <h3 class="mb-0">Awantipora Weather</h3>
            <div class="mb-1 text-muted">11 Dec , 2023</div>
            <p class="mb-auto">The term “weather” refers to the temporary conditions of the atmosphere, the layer of air that surrounds the Earth. We usually think of weather in terms of the state of the atmosphere in our own part of the world.</p>
            <a href="https://www.accuweather.com/en/in/awantipora/359186/weather-forecast/359186" class="stretched-link" target="blank">Continue reading</a> 
          </div>
          <div class="col-auto d-none d-lg-block">
            <img class="bd-placeholder-img" width="200" height="250" src="/static/images/sun.png" alt="react_pic">
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="conatainer my-4">
    <div class="row mb-2">
      <div class="col-md-6">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            <strong class="d-inline-block mb-2 text-primary">No Objection Certificate</strong>
            <h3 class="mb-0">Download NOC</h3>
            <div class="mb-1 text-muted">Dec 11 , 2023</div>
            <p class="card-text mb-auto">You can download your No Objection Certificate (NOC) here. <p>
              <a href="{% url 'noc_form' %}" class="stretched-link">Continue reading</a>
          </div>
          <div class="col-auto d-none d-lg-block">
            <img class="bd-placeholder-img" width="200" height="250" src="/static/images/noc.jpg" alt="js_pic">  
            </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            <strong class="d-inline-block mb-2 text-success">Mess Committee</strong>
            <h3 class="mb-0">List of Mess Committee</h3>
            <div class="mb-1 text-muted">11 Dec , 2023</div>
            <p class="mb-auto">Here is a list of Mess Committee of your hostel.</p>
            <a href="{% url 'mess_committee' %}" class="stretched-link">Continue reading</a>
          </div>
          <div class="col-auto d-none d-lg-block">
            <img class="bd-placeholder-img" width="200" height="250" src="/static/images/list.jpg"  alt="react_pic">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>





<!-- Profile Card -->
<div id="profileCard" class="card"
     style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; width: 400px;">
  <div class="card-body">
    <!-- 1. Profile Picture (in a larger circle) -->
    <div class="text-center mb-3">
      <label for="profilePictureInput">
        <img id="profilePicturePreview" src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/blank-profile.png' %}{% endif %}" alt="Profile Picture"
             class="rounded-circle" style="width: 150px; height: 150px; cursor: pointer;">
        <input type="file" id="profilePictureInput" style="display: none;" accept="image/*">
      </label>
    </div>

    <!-- 2. Choose Profile Picture (button) -->
    <button class="btn btn-primary mb-3" id="chooseProfilePictureBtn">Choose Profile Picture</button>

    <!-- 3. Horizontal Line with adjusted styles -->
    <hr class="my-3" style="border: 0; height: 3px; background: linear-gradient(135deg, #0056b3, #fc8003);">

    <!-- 4. User Details (Name and Registration Number) with bolder text -->
    <p><strong>Name:</strong> {{ full_name }}</p>
    <p><strong>Reg.NO:</strong> {{ user.registration_number }}</p>

    <!-- 5. Change Password Link/Button with adjusted styles -->
    <p><a href="{% url 'password_change' %}" style="color: #0056b3; text-decoration: none; font-weight: bold;">Change Password</a></p>

    <!-- 6. Logout Link/Button with adjusted styles -->
    <p><a href="{% url 'logout' %}" style="color: #fc0303; text-decoration: none; font-weight: bold;">Logout</a></p>

    <!-- 7. Close Button -->
    <button id="closeProfileCardBtn" class="btn btn-secondary" onclick="hideProfileCard()">Close</button>
  </div>
</div>

    <!-- Your existing script code ... -->
    <script>
      // Function to handle profile picture change
function handleProfilePictureChange() {
  var input = document.getElementById('profilePictureInput');
  var preview = document.getElementById('profilePicturePreview');
  var file = input.files[0];

  if (file) {
    var reader = new FileReader();
    reader.onload = function (e) {
      preview.src = e.target.result;

      // Send an AJAX request to save the profile picture
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/save_profile_picture/', true);
      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');

      // Create a FormData object and append the file to it
      var formData = new FormData();
      formData.append('image_data', file);

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          console.log('Response received:', xhr.status, xhr.responseText);
          if (xhr.status === 200) {
            // Profile picture saved successfully
            console.log('Profile picture saved successfully');
          } else {
            console.error('Error saving profile picture:', xhr.status, xhr.responseText);
          }
        }
      };

      // Send the FormData with the image data
      xhr.send(formData);
    };
    reader.readAsDataURL(file);
  }
}

  
      // Optional: If you want to allow choosing a profile picture on button click
      document.getElementById('chooseProfilePictureBtn').addEventListener('click', function () {
          document.getElementById('profilePictureInput').click();
      });
  
      document.getElementById('profilePictureInput').addEventListener('change', handleProfilePictureChange);
  
      document.getElementById('notification-button').addEventListener('click', function () {
          window.location.href = "{% url 'notifications' %}";
      });
  
      // Function to retrieve and display profile picture on page load
function displayProfilePicture() {
  var preview = document.getElementById('profilePicturePreview');

  // Retrieve the profile picture URL using an AJAX request
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '/get_profile_picture/', true);
  xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
          if (xhr.status === 200) {
              var response = JSON.parse(xhr.responseText);
              if (response.status === 'success' && response.profile_picture_url) {
                  // Display the profile picture
                  preview.src = response.profile_picture_url;
              } else {
                  console.error('Error retrieving profile picture:', response.message);
              }
          } else {
              console.error('Error retrieving profile picture. HTTP status:', xhr.status);
          }
      }
  };
  xhr.send();
}

  
      // Function to show the profile card
      function showProfileCard() {
          // Ensure that the profile picture is displayed when the card is shown
          displayProfilePicture();
          document.getElementById('profileCard').style.display = 'block';
      }
  
      // ... rest of your existing script ...
  
      // Call displayProfilePicture when the page loads
      window.addEventListener('load', function () {
          displayProfilePicture();
          // Additional log to check if the load event is triggered
          console.log('Page loaded');
      });
  
      document.getElementById('notification-button').addEventListener('click', function () {
          window.location.href = "{% url 'notifications' %}";
      });
  </script>
  
    
    
    


    <script>
      document.getElementById("notification-button").addEventListener("click", function() {
          window.location.href = "{% url 'notifications' %}";
      });
  </script>


  
  </body>
  {% endblock content %}
